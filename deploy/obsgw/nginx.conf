server {
  listen 80;
  server_name obs-gw.local;

  # Metrics -> VictoriaMetrics
  location /api/obs/v1/metrics/ {
    proxy_pass http://victoriametrics:8428/;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
  }

  # Logs -> VictoriaLogs
  location /api/obs/v1/logs/ {
    proxy_pass http://victorialogs:9428/;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
  }

  # Traces cold -> Tempo by trace_id
  location ~ ^/api/obs/v1/traces/([0-9a-f]{32})$ {
    proxy_pass http://tempo:3200/api/traces/$1;
    proxy_set_header Host $host;
  }

  # Traces search -> OpenObserve
  location = /api/obs/v1/traces/search {
    proxy_pass http://openobserve:5080/api/traces/search;
    proxy_set_header Host $host;
  }

  # Unified redirect helper
  location ~ ^/api/obs/v1/traces/go/([0-9a-f]{32})$ {
    return 302 /api/obs/v1/traces/$1;
  }
}
